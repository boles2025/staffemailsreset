<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة طلبات البوابة الإلكترونية - جامعة المنيا</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-blue: #0c2461;
            --secondary-blue: #1e3799;
            --accent-teal: #26d0ce;
            --accent-purple: #8e44ad;
            --glass-bg: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.15);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --info-color: #3498db;
            --light-color: #f8f9fa;
            --dark-color: #2c3e50;
            --admin-bg: #0d1b2a;
            --admin-card-bg: #1b263b;
            --admin-text: #e0e1dd;
            --admin-primary: #415a77;
            --admin-secondary: #778da9;
            --text-dark: #222831; /* تم تعديله ليكون أغمق */
            --text-light: #ffffff;
            --modal-bg: #ffffff;
        }
        
        * {
            font-family: 'Cairo', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(-45deg, #0c2461, #1e3799, #8e44ad, #26d0ce);
            background-size: 400% 400%;
            animation: gradientBG 18s ease infinite;
            min-height: 100vh;
            overflow-x: hidden;
            color: var(--text-light);
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(38, 208, 206, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(142, 68, 173, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(30, 55, 153, 0.15) 0%, transparent 50%);
            z-index: -1;
            pointer-events: none;
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Admin Interface Specific Styles */
        #adminInterface {
            background: var(--admin-bg) !important;
            color: var(--admin-text) !important;
        }
        
        #adminInterface .glass-container {
            background: rgba(27, 38, 59, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        #adminInterface .hero-title {
            color: var(--admin-text);
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }
        
        #adminInterface .nav-tabs {
            border-bottom-color: rgba(255, 255, 255, 0.1);
        }
        
        #adminInterface .nav-tabs .nav-link {
            background: rgba(65, 90, 119, 0.5);
            border-color: rgba(255, 255, 255, 0.1);
            color: var(--admin-text);
        }
        
        #adminInterface .nav-tabs .nav-link.active {
            background: var(--admin-primary);
            border-color: var(--accent-teal);
            color: white;
        }
        
        #adminInterface .table-container {
            background: rgba(27, 38, 59, 0.95);
        }
        
        #adminInterface .table-dark {
            background: rgba(13, 27, 42, 0.95);
        }
        
        #adminInterface .table-dark th {
            background: var(--admin-primary);
            color: white;
        }
        
        #adminInterface .table-dark td {
            color: var(--admin-text);
            border-color: rgba(255, 255, 255, 0.05);
        }
        
        #adminInterface .stats-card {
            background: rgba(27, 38, 59, 0.95);
            border: 2px solid rgba(65, 90, 119, 0.5);
        }
        
        #adminInterface .stats-number {
            color: var(--accent-teal);
        }
        
        #adminInterface .stats-label {
            color: var(--admin-secondary);
        }
        
        #adminInterface .email-section {
            background: rgba(27, 38, 59, 0.95);
            border-color: rgba(65, 90, 119, 0.5);
        }
        
        #adminInterface .danger-zone {
            background: rgba(27, 38, 59, 0.95);
            border-color: var(--danger-color);
        }
        
        #adminInterface .form-control,
        #adminInterface .form-select {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
            color: var(--admin-text);
        }
        
        #adminInterface .form-control::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        #adminInterface .form-control:focus,
        #adminInterface .form-select:focus {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent-teal);
            color: white;
        }
        
        .glass-container {
            background: var(--glass-bg);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border-radius: 25px;
            border: 1px solid var(--glass-border);
            box-shadow: 
                var(--glass-shadow),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            padding: 35px;
            margin-bottom: 30px;
            transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }
        
        .glass-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-teal), var(--accent-purple), var(--secondary-blue));
            background-size: 200% 100%;
            animation: shimmer 3s infinite linear;
            z-index: 1;
        }
        
        .glass-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.1), 
                transparent);
            transition: 0.8s;
        }
        
        .glass-container:hover::after {
            left: 100%;
        }
        
        .glass-container:hover {
            transform: translateY(-12px) scale(1.02);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.25);
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .header-section {
            background: rgba(12, 36, 97, 0.85);
            backdrop-filter: blur(15px);
            border-bottom: 3px solid var(--accent-teal);
            padding: 20px 0;
            margin-bottom: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .header-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, 
                rgba(38, 208, 206, 0.1), 
                rgba(142, 68, 173, 0.1));
            z-index: 0;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            z-index: 1;
        }
        
        .university-logo {
            height: 120px;
            width: auto;
            filter: drop-shadow(0 8px 20px rgba(0, 0, 0, 0.3));
            transition: all 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            animation: floatLogo 8s ease-in-out infinite;
        }
        
        @keyframes floatLogo {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(3deg); }
        }
        
        .university-logo:hover {
            transform: scale(1.15) rotate(5deg);
            filter: drop-shadow(0 15px 30px rgba(0, 0, 0, 0.4)) 
                    brightness(1.3);
        }
        
        .university-info {
            text-align: center;
            color: white;
            position: relative;
            z-index: 1;
        }
        
        .university-info h1 {
            font-weight: 900;
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #fff, var(--accent-teal));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            animation: textGlow 3s ease-in-out infinite alternate;
        }
        
        @keyframes textGlow {
            from { filter: drop-shadow(0 0 5px rgba(38, 208, 206, 0.5)); }
            to { filter: drop-shadow(0 0 15px rgba(38, 208, 206, 0.8)); }
        }
        
        .university-info h2 {
            font-weight: 700;
            font-size: 2rem;
            color: var(--accent-teal);
            margin-bottom: 8px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .university-info h3 {
            font-weight: 600;
            font-size: 1.6rem;
            color: #fff;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .hero-section {
            text-align: center;
            padding: 80px 0 50px;
            position: relative;
            overflow: hidden;
        }
        
        .hero-section::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(38, 208, 206, 0.1) 0%, transparent 70%);
            z-index: -1;
            animation: pulseRing 8s ease-in-out infinite;
        }
        
        @keyframes pulseRing {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.7; }
            50% { transform: translate(-50%, -50%) scale(1.1); opacity: 0.4; }
        }
        
        .hero-title {
            font-size: 4rem;
            font-weight: 900;
            color: white;
            text-shadow: 
                0 5px 20px rgba(0, 0, 0, 0.5),
                0 0 30px rgba(38, 208, 206, 0.5);
            margin-bottom: 30px;
            animation: fadeInDown 1.2s ease, titleFloat 6s ease-in-out infinite;
        }
        
        @keyframes titleFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .hero-subtitle {
            font-size: 1.6rem;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 60px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.8;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 80px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 30px 60px;
            font-size: 1.4rem;
            font-weight: 700;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            min-width: 300px;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            transform-style: preserve-3d;
            perspective: 1000px;
        }
        
        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: 0.8s;
        }
        
        .action-btn:hover::before {
            left: 100%;
        }
        
        .action-btn:hover {
            transform: 
                translateY(-15px) 
                scale(1.08) 
                rotateX(5deg);
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.4),
                0 0 30px rgba(38, 208, 206, 0.3);
        }
        
        .action-btn i {
            font-size: 2.2rem;
            transition: transform 0.6s ease;
        }
        
        .action-btn:hover i {
            transform: scale(1.2) rotate(15deg);
        }
        
        .btn-primary-custom {
            background: linear-gradient(135deg, 
                var(--primary-blue), 
                var(--accent-purple),
                var(--accent-teal));
            background-size: 200% 200%;
            animation: gradientMove 5s ease infinite;
            color: white;
        }
        
        .btn-secondary-custom {
            background: linear-gradient(135deg, 
                rgba(44, 62, 80, 0.8), 
                rgba(52, 73, 94, 0.8));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        @keyframes gradientMove {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .admin-section {
            display: none;
        }
        
        .footer {
            background: rgba(12, 36, 97, 0.9);
            backdrop-filter: blur(20px);
            color: white;
            padding: 50px 0 25px;
            margin-top: 100px;
            text-align: center;
            border-top: 3px solid var(--accent-teal);
            position: relative;
            overflow: hidden;
        }
        
        .footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, 
                rgba(38, 208, 206, 0.1), 
                rgba(142, 68, 173, 0.1));
            z-index: 0;
        }
        
        .developer-info {
            font-size: 1.2rem;
            margin-top: 25px;
            color: rgba(255, 255, 255, 0.9);
            position: relative;
            z-index: 1;
        }
        
        .developer-info strong {
            color: var(--accent-teal);
            text-shadow: 0 0 10px rgba(38, 208, 206, 0.5);
        }
        
        .tab-content {
            padding: 25px 0;
        }
        
        .nav-tabs {
            border-bottom: 3px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 35px;
            position: relative;
        }
        
        .nav-tabs::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, 
                var(--accent-teal), 
                var(--accent-purple),
                var(--secondary-blue));
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.5s ease;
        }
        
        .nav-tabs:hover::after {
            transform: scaleX(1);
        }
        
        .nav-tabs .nav-link {
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.15);
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px 15px 0 0;
            margin: 0 8px;
            padding: 15px 30px;
            font-weight: 700;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .nav-tabs .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.6s;
        }
        
        .nav-tabs .nav-link:hover::before {
            left: 100%;
        }
        
        .nav-tabs .nav-link.active {
            background: rgba(255, 255, 255, 0.25);
            color: white;
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-5px);
            box-shadow: 
                0 10px 25px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        .nav-tabs .nav-link:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
            border-color: rgba(255, 255, 255, 0.25);
        }
        
        .nav-tabs .nav-link i {
            margin-left: 8px;
            transition: transform 0.4s ease;
        }
        
        .nav-tabs .nav-link:hover i {
            transform: scale(1.2) rotate(10deg);
        }
        
        /* تحسينات الجداول لعرض جميع الأعمدة على الموبايل */
        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .table-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .table-container table {
            min-width: 1000px; /* الحد الأدنى للعرض لضمان ظهور جميع الأعمدة */
            width: 100%;
        }
        
        .table-dark {
            background: rgba(44, 62, 80, 0.95);
            color: white;
        }
        
        .table-dark th {
            background: rgba(12, 36, 97, 0.9);
            border-color: rgba(255, 255, 255, 0.15);
            font-weight: 800;
            padding: 15px;
            font-size: 0.95rem;
            text-align: center;
            backdrop-filter: blur(10px);
            white-space: nowrap;
        }
        
        .table-dark td {
            border-color: rgba(255, 255, 255, 0.1);
            vertical-align: middle;
            padding: 12px;
            text-align: center;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            min-width: 100px;
        }
        
        .table-dark tbody tr {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .table-dark tbody tr:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(10px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        /* تحسين الجداول في المشرف */
        #adminInterface .table-container table {
            min-width: 800px;
        }
        
        #adminInterface .table-dark th {
            font-size: 0.85rem;
            padding: 12px 8px;
        }
        
        #adminInterface .table-dark td {
            font-size: 0.8rem;
            padding: 10px 6px;
        }
        
        /* تحسين جداول الإحصائيات */
        .stats-modal-table {
            width: 100%;
            margin-top: 25px;
            border-collapse: collapse;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            min-width: 600px;
        }
        
        .stats-modal-table th {
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 800;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
            white-space: nowrap;
        }
        
        .stats-modal-table td {
            padding: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            background: rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }
        
        .stats-modal-table tr:nth-child(even) td {
            background: rgba(255, 255, 255, 0.08);
        }
        
        .stats-modal-table tr:hover td {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(10px);
        }
        
        .form-control, .form-select {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 12px 15px;
            font-size: 1rem;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            color: white;
            backdrop-filter: blur(10px);
        }
        
        .form-control::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .form-control:focus, .form-select:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--accent-teal);
            box-shadow: 
                0 0 0 0.3rem rgba(38, 208, 206, 0.25),
                0 10px 30px rgba(0, 0, 0, 0.2);
            transform: translateY(-5px);
            color: white;
        }
        
        .image-preview-container {
            border: 3px dashed rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            margin-top: 15px;
            background: rgba(255, 255, 255, 0.05);
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }
        
        .image-preview-container:hover {
            border-color: var(--accent-teal);
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 400px;
            border-radius: 15px;
            display: none;
            margin-top: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.2);
            animation: fadeIn 0.8s ease;
        }
        
        .modal-content {
            background: var(--modal-bg);
            backdrop-filter: blur(25px);
            border-radius: 25px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 
                0 30px 80px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            overflow: hidden;
        }
        
        .modal-header {
            border-bottom: 3px solid rgba(0, 0, 0, 0.1);
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-purple));
            color: white;
            border-radius: 25px 25px 0 0;
            padding: 20px 25px;
            position: relative;
            overflow: hidden;
        }
        
        .modal-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, 
                rgba(38, 208, 206, 0.3), 
                rgba(142, 68, 173, 0.3));
            z-index: 0;
        }
        
        .modal-title {
            font-weight: 800;
            font-size: 1.5rem;
            position: relative;
            z-index: 1;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .modal-body {
            color: var(--text-dark);
            padding: 25px;
        }
        
        .modal-body label {
            color: var(--text-dark);
            font-weight: 800; /* تم التعديل إلى bold */
            font-size: 1.1rem;
        }
        
        .modal-body p {
            color: var(--text-dark);
            font-weight: 600; /* خط bold للفقرات */
        }
        
        .btn-close {
            filter: brightness(0) invert(1);
            opacity: 0.8;
            transition: all 0.3s ease;
        }
        
        .btn-close:hover {
            opacity: 1;
            transform: rotate(90deg);
        }
        
        .btn-action {
            padding: 8px 15px;
            border-radius: 12px;
            font-weight: 700;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            border: none;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
            min-width: 100px;
            font-size: 0.85rem;
        }
        
        .btn-action::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: 0.6s;
        }
        
        .btn-action:hover::before {
            left: 100%;
        }
        
        .btn-action:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 
                0 10px 25px rgba(0, 0, 0, 0.3),
                0 0 15px rgba(255, 255, 255, 0.2);
        }
        
        /* أزرار الإجراءات مع أيقونات فقط (تم التعديل) */
        .btn-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin: 0 5px;
            font-size: 1rem;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .btn-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: 0.6s;
        }
        
        .btn-icon:hover::before {
            left: 100%;
        }
        
        .btn-icon:hover {
            transform: translateY(-5px) scale(1.2) rotate(10deg);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        .btn-icon-view {
            background: linear-gradient(135deg, var(--info-color), #2980b9);
            color: white;
        }
        
        .btn-icon-download {
            background: linear-gradient(135deg, var(--warning-color), #e67e22);
            color: white;
        }
        
        .btn-icon-email {
            background: linear-gradient(135deg, var(--success-color), #27ae60);
            color: white;
        }
        
        .btn-icon-whatsapp {
            background: linear-gradient(135deg, #25D366, #128C7E);
            color: white;
        }
        
        .btn-icon::after {
            content: attr(title);
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 5px;
            font-size: 0.7rem;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 1000;
        }
        
        .btn-icon:hover::after {
            opacity: 1;
        }
        
        .btn-view {
            background: linear-gradient(135deg, var(--info-color), #2980b9);
            color: white;
        }
        
        .btn-download {
            background: linear-gradient(135deg, var(--warning-color), #e67e22);
            color: white;
        }
        
        .btn-email {
            background: linear-gradient(135deg, var(--success-color), #27ae60);
            color: white;
        }
        
        .btn-whatsapp {
            background: linear-gradient(135deg, #25D366, #128C7E);
            color: white;
        }
        
        .btn-approve {
            background: linear-gradient(135deg, var(--success-color), #27ae60);
            color: white;
        }
        
        .btn-reject {
            background: linear-gradient(135deg, var(--danger-color), #c0392b);
            color: white;
        }
        
        .status-badge {
            padding: 8px 15px;
            border-radius: 25px;
            font-weight: 700;
            font-size: 0.85rem;
            backdrop-filter: blur(10px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.4s ease;
            display: inline-block;
        }
        
        .status-badge:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: linear-gradient(135deg, var(--danger-color), #c0392b);
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            animation: pulse 2s infinite;
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }
        
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4); }
            50% { transform: scale(1.15); box-shadow: 0 10px 25px rgba(231, 76, 60, 0.6); }
            100% { transform: scale(1); box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4); }
        }
        
        .floating-element {
            animation: float 8s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-25px) rotate(5deg); }
        }
        
        .fade-in {
            animation: fadeIn 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(30px) scale(0.95); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }
        
        .admin-access-btn {
            position: fixed;
            bottom: 40px;
            left: 40px;
            z-index: 1000;
            background: linear-gradient(135deg, var(--accent-purple), var(--primary-blue));
            color: white;
            border: none;
            border-radius: 50px;
            padding: 15px 25px;
            font-weight: 800;
            box-shadow: 
                0 15px 40px rgba(0, 0, 0, 0.4),
                0 0 20px rgba(142, 68, 173, 0.3);
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            animation: adminBtnFloat 6s ease-in-out infinite;
        }
        
        @keyframes adminBtnFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
        }
        
        .admin-access-btn:hover {
            transform: translateY(-10px) scale(1.1) rotate(10deg);
            box-shadow: 
                0 25px 60px rgba(0, 0, 0, 0.5),
                0 0 30px rgba(142, 68, 173, 0.5);
            background: linear-gradient(135deg, var(--accent-teal), var(--accent-purple));
        }
        
        .loader {
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top: 5px solid var(--accent-teal);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1.5s linear infinite;
            margin: 40px auto;
            box-shadow: 0 0 30px rgba(38, 208, 206, 0.3);
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .camera-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            border: 3px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }
        
        #cameraVideo {
            width: 100%;
            display: block;
            transition: transform 0.5s ease;
        }
        
        #cameraVideo:hover {
            transform: scale(1.02);
        }
        
        .camera-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 12px;
            z-index: 10;
        }
        
        .camera-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.9);
            color: var(--primary-blue);
            font-size: 20px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .camera-btn:hover {
            background: white;
            transform: scale(1.15) rotate(15deg);
            box-shadow: 
                0 15px 40px rgba(0, 0, 0, 0.4),
                0 0 20px rgba(255, 255, 255, 0.3);
        }
        
        .stats-section-admin {
            margin-bottom: 40px;
        }
        
        .stats-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 30px 20px;
            text-align: center;
            box-shadow: 
                0 15px 40px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            margin-bottom: 25px;
            transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            backdrop-filter: blur(10px);
        }
        
        .stats-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--accent-teal), var(--accent-purple), var(--secondary-blue));
            background-size: 200% 100%;
            animation: shimmer 4s infinite linear;
        }
        
        .stats-card:hover {
            transform: 
                translateY(-10px) 
                scale(1.05) 
                rotateX(5deg);
            box-shadow: 
                0 25px 60px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.15),
                0 0 30px rgba(38, 208, 206, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .stats-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--accent-teal), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.3));
            transition: all 0.5s ease;
        }
        
        .stats-card:hover .stats-icon {
            transform: scale(1.2) rotate(15deg);
            filter: drop-shadow(0 10px 25px rgba(0, 0, 0, 0.4));
        }
        
        .stats-number {
            font-size: 2.5rem;
            font-weight: 900;
            color: white;
            margin-bottom: 12px;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.5s ease;
        }
        
        .stats-card:hover .stats-number {
            color: var(--accent-teal);
            text-shadow: 
                0 5px 15px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(38, 208, 206, 0.4);
        }
        
        .stats-label {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 700;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .email-section {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 20px;
            margin-top: 20px;
            border: 2px solid rgba(38, 208, 206, 0.3);
            backdrop-filter: blur(10px);
            transition: all 0.5s ease;
        }
        
        .email-section:hover {
            border-color: var(--accent-teal);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            transform: translateY(-5px);
        }
        
        .action-buttons-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 20px;
        }
        
        .danger-zone {
            border: 3px solid var(--danger-color);
            border-radius: 25px;
            padding: 25px;
            margin-top: 30px;
            background: rgba(231, 76, 60, 0.1);
            backdrop-filter: blur(10px);
            box-shadow: 
                0 15px 40px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transition: all 0.5s ease;
        }
        
        .danger-zone:hover {
            box-shadow: 
                0 20px 50px rgba(231, 76, 60, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
            transform: translateY(-5px);
        }
        
        .email-input-group {
            position: relative;
        }
        
        .email-domain {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.8);
            font-weight: 600;
            font-size: 1rem;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .email-input-with-domain {
            padding-left: 100px !important;
        }
        
        /* تنسيقات النصوص المحسنة */
        .text-black-bold {
            color: #000000 !important;
            font-weight: 900 !important;
            text-shadow: 0 1px 3px rgba(255, 255, 255, 0.3);
        }
        
        .text-dark-bold {
            color: var(--text-dark) !important;
            font-weight: 900 !important;
        }
        
        /* تحسين شكل أزرار الإجراءات في الجدول */
        .action-icons-container {
            display: flex;
            justify-content: center;
            gap: 8px;
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            .hero-title { font-size: 3.2rem; }
            .action-buttons { gap: 30px; }
            .action-btn { 
                min-width: 280px; 
                padding: 25px 50px;
            }
        }
        
        @media (max-width: 992px) {
            .hero-title { font-size: 2.8rem; }
            .hero-subtitle { font-size: 1.4rem; }
            .university-info h1 { font-size: 2.2rem; }
            .university-info h2 { font-size: 1.6rem; }
            .university-info h3 { font-size: 1.3rem; }
            .university-logo { height: 100px; }
            .action-btn { 
                min-width: 250px; 
                padding: 22px 40px;
                font-size: 1.2rem;
            }
            .stats-number { font-size: 2.2rem; }
            .stats-icon { font-size: 2.5rem; }
        }
        
        @media (max-width: 768px) {
            .hero-title { font-size: 2.4rem; }
            .hero-subtitle { font-size: 1.2rem; }
            .university-info h1 { font-size: 1.8rem; }
            .university-info h2 { font-size: 1.3rem; }
            .university-info h3 { font-size: 1.1rem; }
            .university-logo { height: 80px; }
            .glass-container { padding: 25px; }
            .action-btn { 
                min-width: 100%; 
                max-width: 400px;
                padding: 20px 35px;
            }
            .stats-number { font-size: 2rem; }
            .stats-icon { font-size: 2rem; }
            .stats-label { font-size: 1rem; }
            .admin-access-btn {
                bottom: 20px;
                left: 20px;
                padding: 12px 20px;
                font-size: 0.9rem;
            }
            #adminInterface .stats-card {
                padding: 20px 15px;
            }
            /* تعديل شاشة المشرف لتكون متجاوبة */
            #adminInterface .container {
                padding: 15px;
            }
            #adminInterface .table-container table {
                min-width: 700px;
            }
        }
        
        @media (max-width: 576px) {
            .hero-title { font-size: 2rem; }
            .hero-subtitle { font-size: 1rem; margin-bottom: 40px; }
            .university-logo { height: 60px; }
            .action-btn { 
                padding: 18px 30px; 
                font-size: 1.1rem;
                gap: 12px;
            }
            .action-btn i { font-size: 1.8rem; }
            .glass-container { padding: 20px; }
            .nav-tabs .nav-link {
                padding: 12px 20px;
                font-size: 0.9rem;
                margin: 0 5px;
            }
            .admin-access-btn { 
                bottom: 15px; 
                left: 15px; 
                padding: 10px 18px; 
                font-size: 0.8rem;
                gap: 8px;
            }
            .table-container table {
                min-width: 700px;
            }
            .table-dark th, .table-dark td {
                padding: 10px 8px;
                font-size: 0.8rem;
            }
            .btn-action {
                padding: 6px 12px;
                font-size: 0.8rem;
                min-width: 90px;
                gap: 5px;
            }
            .btn-icon {
                width: 35px;
                height: 35px;
                font-size: 0.9rem;
            }
            .email-input-group {
                margin-bottom: 15px;
            }
            .email-domain {
                position: static;
                transform: none;
                margin-bottom: 10px;
                display: block;
                text-align: right;
            }
            .email-input-with-domain {
                padding-left: 20px !important;
            }
            #adminInterface .nav-tabs .nav-link {
                padding: 8px 12px;
                font-size: 0.75rem;
                margin: 0 2px;
            }
            #adminInterface .table-container table {
                min-width: 600px;
            }
            #adminInterface .hero-title {
                font-size: 1.8rem;
            }
        }
        
        @media (max-width: 480px) {
            .hero-title { font-size: 1.8rem; }
            .hero-subtitle { font-size: 0.95rem; }
            .table-container table {
                min-width: 650px;
            }
            .table-dark th, .table-dark td {
                padding: 8px 6px;
                font-size: 0.75rem;
            }
            .btn-action {
                padding: 5px 10px;
                font-size: 0.75rem;
                min-width: 80px;
            }
            .btn-icon {
                width: 30px;
                height: 30px;
                font-size: 0.8rem;
                margin: 0 3px;
            }
            .modal-dialog {
                margin: 10px;
            }
            .stats-card {
                padding: 20px 15px;
            }
            #adminInterface .stats-number {
                font-size: 1.8rem;
            }
            #adminInterface .stats-icon {
                font-size: 1.8rem;
            }
            #adminInterface .table-container table {
                min-width: 550px;
            }
            #adminInterface .hero-title {
                font-size: 1.6rem;
            }
        }
        
        @media (max-width: 360px) {
            .table-container table {
                min-width: 600px;
            }
            .table-dark th, .table-dark td {
                padding: 6px 4px;
                font-size: 0.7rem;
            }
            .btn-icon {
                width: 28px;
                height: 28px;
                font-size: 0.75rem;
                margin: 0 2px;
            }
        }
    </style>
</head>
<body>
    <!-- Header Section -->
    <div class="header-section">
        <div class="container">
            <div class="logo-container">
                <div class="university-logo-container">
                    <img src="https://i.ibb.co/zhWm2VC9/university-logo.png" alt="شعار جامعة المنيا" class="university-logo floating-element">
                </div>
                <div class="university-info">
                    <h1>جامعة المنيا</h1>
                    <h2>مركز تكنولوجيا المعلومات</h2>
                    <h3>البوابة الإلكترونية</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal for Admin -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="loginModalLabel">تسجيل دخول المشرف</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="adminPassword" class="form-label text-dark-bold">كلمة المرور</label>
                        <input type="password" class="form-control" id="adminPassword" placeholder="أدخل كلمة المرور">
                        <div class="form-text text-dark-bold"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-primary" id="loginBtn">تسجيل الدخول</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Details Modal -->
    <div class="modal fade" id="statsDetailsModal" tabindex="-1" aria-labelledby="statsDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="statsDetailsModalLabel">تفاصيل الإحصائيات</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="statsDetailsContent">
                        <!-- سيتم ملؤها بواسطة JavaScript -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
                    <button type="button" class="btn btn-primary" id="exportStatsBtn">تصدير البيانات</button>
                </div>
            </div>
        </div>
    </div>

    <!-- User Interface -->
    <div id="userInterface">
        <!-- Hero Section -->
        <div class="hero-section">
            <div class="container">
                <h1 class="hero-title animate__animated animate__fadeInDown">نظام إدارة طلبات البوابة الإلكترونية</h1>
                <p class="hero-subtitle animate__animated animate__fadeInUp">خدمة إلكترونية متكاملة لتقديم ومتابعة طلبات إنشاء وإعادة تعيين كلمات المرور لأعضاء هيئة التدريس</p>
                
                <div class="action-buttons animate__animated animate__fadeInUp">
                    <button class="action-btn btn-primary-custom" id="newRequestBtn">
                        <i class="fas fa-plus-circle fa-2x"></i>
                        <span>تقديم طلب جديد</span>
                    </button>
                    <button class="action-btn btn-secondary-custom" id="trackRequestBtn">
                        <i class="fas fa-search fa-2x"></i>
                        <span>متابعة الطلبات</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- New Request Section (Hidden by default) -->
        <div id="newRequestSection" style="display: none;">
            <div class="container">
                <div class="glass-container animate__animated animate__fadeIn">
                    <h3 class="text-center text-white mb-4">
                        <i class="fas fa-user-circle me-2"></i>
                        طلب إنشاء/إعادة تعيين كلمة المرور
                    </h3>
                    
                    <div class="text-center mb-5">
                        <button class="btn btn-lg btn-success mb-3" id="downloadFormBtn">
                            <i class="fas fa-download me-2"></i> تحميل نموذج الطلب
                        </button>
                        <p class="text-white-50">قم بتحميل النموذج وتعبئته ثم رفعه بعد التوقيع من عميد الكلية</p>
                    </div>
                    
                    <form id="requestForm">
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <label for="staffName" class="form-label text-white required text-black-bold">اسم عضو هيئة التدريس</label>
                                <input type="text" class="form-control" id="staffName" placeholder="الاسم بالكامل" required>
                            </div>
                            
                            <div class="col-md-6 mb-4">
                                <label for="nationalId" class="form-label text-white required text-black-bold">الرقم القومي</label>
                                <input type="text" class="form-control" id="nationalId" placeholder="14 رقم" pattern="[0-9]{14}" required>
                                <div class="form-text text-white-50">يجب أن يتكون الرقم القومي من 14 رقمًا</div>
                            </div>
                            
                            <div class="col-md-6 mb-4">
                                <label for="mobileNumber" class="form-label text-white required text-black-bold">رقم الهاتف المحمول</label>
                                <input type="tel" class="form-control" id="mobileNumber" placeholder="010XXXXXXXX" pattern="01[0-9]{9}" required>
                                <div class="form-text text-white-50">يجب أن يبدأ بـ 01 ويتكون من 11 رقمًا</div>
                            </div>
                            
                            <div class="col-md-6 mb-4">
                                <label for="contactEmail" class="form-label text-white required text-black-bold">البريد الإلكتروني للتواصل</label>
                                <input type="email" class="form-control" id="contactEmail" placeholder="email@domain.com" required>
                            </div>
                            
                            <div class="col-12 mb-4">
                                <label class="form-label text-white required text-black-bold">نوع العملية</label>
                                <div class="d-flex flex-wrap gap-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="operationType" id="createPassword" value="create" checked required>
                                        <label class="form-check-label text-white text-black-bold" for="createPassword">
                                            إنشاء بريد إلكتروني جديد
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="operationType" id="resetPassword" value="reset" required>
                                        <label class="form-check-label text-white text-black-bold" for="resetPassword">
                                            إعادة تعيين كلمة المرور
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- حقل البريد الإلكتروني للإنشاء (يظهر فقط عند اختيار إنشاء) -->
                            <div class="col-12 mb-4" id="createEmailField" style="display: none;">
                                <label for="newEmail" class="form-label text-white required text-black-bold">البريد الإلكتروني المقترح لإنشائه</label>
                                <div class="email-input-group">
                                    <span class="email-domain">@mu.edu.eg</span>
                                    <input type="text" class="form-control email-input-with-domain" id="newEmail" placeholder="اسم المستخدم">
                                </div>
                                <div class="form-text text-white-50">سيتم إنشاء البريد الإلكتروني: username@mu.edu.eg</div>
                            </div>
                            
                            <!-- حقل البريد الإلكتروني لإعادة التعيين (يظهر فقط عند اختيار إعادة تعيين) -->
                            <div class="col-12 mb-4" id="resetEmailField" style="display: none;">
                                <label for="resetEmail" class="form-label text-white required text-black-bold">البريد الإلكتروني المراد اعادة تعيين كلمة المرور له</label>
                                <input type="email" class="form-control" id="resetEmail" placeholder="existing@mu.edu.eg">
                                <div class="form-text text-white-50">أدخل البريد الإلكتروني الحالي الذي تريد إعادة تعيين كلمة المرور له</div>
                            </div>
                            
                            <div class="col-12 mb-4">
                                <label for="requestFile" class="form-label text-white required text-black-bold">ملف الطلب الموقع من عميد الكلية</label>
                                <div class="image-preview-container">
                                    <div class="d-flex flex-wrap justify-content-center gap-3 mb-3">
                                        <button type="button" class="btn btn-primary" id="chooseFileBtn">
                                            <i class="fas fa-folder-open me-2"></i> اختيار ملف الطلب
                                        </button>
                                    </div>
                                    
                                    <input type="file" class="form-control" id="requestFile" accept=".jpg,.jpeg,.png,.pdf,.doc,.docx" required>
                                    <div class="form-text text-white-50 mt-2">يمكنك رفع صورة أو ملف PDF أو Word للطلب الموقع من العميد</div>
                                    <div id="fileInfo" class="text-white-50 mt-2" style="display: none;"></div>
                                </div>
                            </div>
                            
                            <div class="col-12 mt-4">
                                <div class="d-flex flex-wrap justify-content-center gap-3">
                                    <button type="submit" class="btn btn-lg btn-primary px-5" id="submitBtn">
                                        <i class="fas fa-paper-plane me-2"></i> إرسال الطلب
                                    </button>
                                    <button type="button" class="btn btn-lg btn-secondary px-5" id="backToMainBtn">
                                        <i class="fas fa-arrow-right me-2"></i> العودة للرئيسية
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Track Request Section (Hidden by default) -->
        <div id="trackRequestSection" style="display: none;">
            <div class="container">
                <div class="glass-container animate__animated animate__fadeIn">
                    <h3 class="text-center text-white mb-4">
                        <i class="fas fa-search me-2"></i>
                        متابعة حالة الطلبات
                    </h3>
                    
                    <div class="mb-5">
                        <div class="input-group input-group-lg">
                            <input type="text" class="form-control" id="trackNationalId" placeholder="أدخل الرقم القومي للبحث عن طلباتك">
                            <button class="btn btn-primary" type="button" id="trackBtn">
                                <i class="fas fa-search me-2"></i> بحث
                            </button>
                        </div>
                        <div class="form-text text-white-50 mt-3">أدخل الرقم القومي الذي استخدمته عند تقديم الطلب لمتابعة حالته</div>
                    </div>
                    
                    <div id="trackResults">
                        <div class="text-center text-white py-5">
                            <i class="fas fa-search fa-4x mb-4 opacity-50"></i>
                            <h4 class="mb-3">متابعة الطلبات</h4>
                            <p class="mb-0">أدخل الرقم القومي للبحث عن طلباتك</p>
                        </div>
                    </div>
                    
                    <div class="text-center mt-4">
                        <button type="button" class="btn btn-lg btn-secondary px-5" id="backToMainBtn2">
                            <i class="fas fa-arrow-right me-2"></i> العودة للرئيسية
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Admin Interface -->
    <div id="adminInterface" class="admin-section">
        <div class="container py-4">
            <div class="d-flex flex-wrap justify-content-between align-items-center mb-4">
                <h1 class="hero-title mb-3 mb-md-0" style="font-size: 2.2rem;">
                    <i class="fas fa-chart-line me-3"></i>
                    لوحة تحكم المشرف
                </h1>
                <button class="btn btn-lg btn-danger" id="logoutBtn">
                    <i class="fas fa-sign-out-alt me-2"></i> تسجيل الخروج
                </button>
            </div>
            
            <!-- Admin Statistics -->
            <div class="row stats-section-admin">
                <div class="col-md-3 col-6">
                    <div class="stats-card stats-total" data-type="total">
                        <div class="stats-icon">
                            <i class="fas fa-paper-plane"></i>
                        </div>
                        <div class="stats-number" id="totalRequestsMain">0</div>
                        <div class="stats-label">إجمالي الطلبات</div>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stats-card stats-create" data-type="create">
                        <div class="stats-icon">
                            <i class="fas fa-plus-circle"></i>
                        </div>
                        <div class="stats-number" id="createRequestsMain">0</div>
                        <div class="stats-label">طلبات إنشاء</div>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stats-card stats-reset" data-type="reset">
                        <div class="stats-icon">
                            <i class="fas fa-redo"></i>
                        </div>
                        <div class="stats-number" id="resetRequestsMain">0</div>
                        <div class="stats-label">طلبات إعادة تعيين</div>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stats-card stats-pending" data-type="pending">
                        <div class="stats-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stats-number" id="pendingRequestsMain">0</div>
                        <div class="stats-label">طلبات قيد الانتظار</div>
                    </div>
                </div>
            </div>
            
            <!-- Admin Tabs -->
            <ul class="nav nav-tabs" id="adminTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="pending-tab" data-bs-toggle="tab" data-bs-target="#pending" type="button" role="tab">
                        <i class="fas fa-clock me-2"></i> الطلبات المعلقة
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="approved-tab" data-bs-toggle="tab" data-bs-target="#approved" type="button" role="tab">
                        <i class="fas fa-check-circle me-2"></i> الطلبات الموافق عليها
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="rejected-tab" data-bs-toggle="tab" data-bs-target="#rejected" type="button" role="tab">
                        <i class="fas fa-times-circle me-2"></i> الطلبات المرفوضة
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="manage-tab" data-bs-toggle="tab" data-bs-target="#manage" type="button" role="tab">
                        <i class="fas fa-cogs me-2"></i> إدارة النظام
                    </button>
                </li>
            </ul>
            
            <div class="tab-content" id="adminTabsContent">
                <!-- Pending Requests Tab -->
                <div class="tab-pane fade show active" id="pending" role="tabpanel">
                    <div class="glass-container mt-4">
                        <div class="d-flex flex-wrap justify-content-between align-items-center mb-4">
                            <h3 class="text-white mb-3 mb-md-0">الطلبات المعلقة للمراجعة</h3>
                            <div class="action-buttons-group">
                                <button class="btn btn-glass me-2" id="downloadAllBtn">
                                    <i class="fas fa-download me-2"></i> تحميل الطلبات
                                </button>
                                <button class="btn btn-glass" id="refreshPendingBtn">
                                    <i class="fas fa-sync-alt me-2"></i> تحديث
                                </button>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <div class="table-responsive">
                                <table class="table table-dark table-hover" id="pendingTable">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>اسم العضو</th>
                                            <th>الرقم القومي</th>
                                            <th>نوع العملية</th>
                                            <th>البريد الإلكتروني</th>
                                            <th>التاريخ</th>
                                            <th>الإجراءات</th>
                                        </tr>
                                    </thead>
                                    <tbody id="pendingTableBody">
                                        <!-- سيتم ملؤها بواسطة JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Approved Requests Tab -->
                <div class="tab-pane fade" id="approved" role="tabpanel">
                    <div class="glass-container mt-4">
                        <div class="d-flex flex-wrap justify-content-between align-items-center mb-4">
                            <h3 class="text-white mb-3 mb-md-0">الطلبات الموافق عليها</h3>
                            <div class="action-buttons-group">
                                <button class="btn btn-glass" id="refreshApprovedBtn">
                                    <i class="fas fa-sync-alt me-2"></i> تحديث
                                </button>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <div class="table-responsive">
                                <table class="table table-dark table-hover" id="approvedTable">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>اسم العضو</th>
                                            <th>الرقم القومي</th>
                                            <th>نوع العملية</th>
                                            <th>البريد الإلكتروني</th>
                                            <th>تاريخ الموافقة</th>
                                            <th>الإجراءات</th>
                                        </tr>
                                    </thead>
                                    <tbody id="approvedTableBody">
                                        <!-- سيتم ملؤها بواسطة JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Rejected Requests Tab -->
                <div class="tab-pane fade" id="rejected" role="tabpanel">
                    <div class="glass-container mt-4">
                        <div class="d-flex flex-wrap justify-content-between align-items-center mb-4">
                            <h3 class="text-white mb-3 mb-md-0">الطلبات المرفوضة</h3>
                            <div class="action-buttons-group">
                                <button class="btn btn-glass" id="refreshRejectedBtn">
                                    <i class="fas fa-sync-alt me-2"></i> تحديث
                                </button>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <div class="table-responsive">
                                <table class="table table-dark table-hover" id="rejectedTable">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>اسم العضو</th>
                                            <th>الرقم القومي</th>
                                            <th>نوع العملية</th>
                                            <th>البريد الإلكتروني</th>
                                            <th>تاريخ الرفض</th>
                                            <th>الإجراءات</th>
                                        </tr>
                                    </thead>
                                    <tbody id="rejectedTableBody">
                                        <!-- سيتم ملؤها بواسطة JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Manage Tab -->
                <div class="tab-pane fade" id="manage" role="tabpanel">
                    <div class="glass-container mt-4">
                        <h3 class="text-white mb-4">إدارة النظام والبيانات</h3>
                        
                        <div class="row">
                            <div class="col-lg-6 mb-4">
                                <div class="email-section">
                                    <h5 class="text-primary mb-3">
                                        <i class="fas fa-envelope me-2"></i>إعدادات البريد الإلكتروني
                                    </h5>
                                    <div class="mb-3">
                                        <label for="adminEmail" class="form-label text-white">بريد المشرف للإرسال</label>
                                        <input type="email" class="form-control" id="adminEmail" placeholder="admin@university.edu">
                                    </div>
                                    <div class="mb-3">
                                        <label for="senderName" class="form-label text-white">اسم المرسل</label>
                                        <input type="text" class="form-control" id="senderName" value="مهندس بولس سمير" placeholder="اسم المرسل">
                                    </div>
                                    <button class="btn btn-success w-100" id="saveEmailSettings">
                                        <i class="fas fa-save me-2"></i> حفظ الإعدادات
                                    </button>
                                </div>
                            </div>
                            
                            <div class="col-lg-6 mb-4">
                                <div class="email-section">
                                    <h5 class="text-primary mb-3">
                                        <i class="fas fa-download me-2"></i>تحميل البيانات
                                    </h5>
                                    <p class="mb-3 text-white">تصدير جميع بيانات النظام</p>
                                    <div class="action-buttons-group">
                                        <button class="btn btn-primary" id="exportAllData">
                                            <i class="fas fa-file-excel me-2"></i> تصدير Excel
                                        </button>
                                        <button class="btn btn-info" id="exportAllPDF">
                                            <i class="fas fa-file-pdf me-2"></i> تصدير PDF
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="danger-zone">
                            <h5 class="text-danger mb-3">
                                <i class="fas fa-exclamation-triangle me-2"></i>منطقة الخطر - حذف البيانات
                            </h5>
                            <p class="text-white mb-3">يمكنك حذف أنواع مختلفة من البيانات. هذا الإجراء لا يمكن التراجع عنه.</p>
                            
                            <div class="row">
                                <div class="col-md-6 col-lg-4 mb-3">
                                    <div class="card border-danger">
                                        <div class="card-body">
                                            <h6 class="card-title text-danger">حذف الطلبات المرفوضة</h6>
                                            <p class="card-text small text-white">حذف جميع الطلبات المرفوضة</p>
                                            <button class="btn btn-outline-danger btn-sm w-100" id="deleteRejectedBtn">
                                                <i class="fas fa-trash me-1"></i> حذف
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6 col-lg-4 mb-3">
                                    <div class="card border-danger">
                                        <div class="card-body">
                                            <h6 class="card-title text-danger">حذف الطلبات المنتهية</h6>
                                            <p class="card-text small text-white">حذف الطلبات القديمة (أكثر من 30 يوم)</p>
                                            <button class="btn btn-outline-danger btn-sm w-100" id="deleteOldBtn">
                                                <i class="fas fa-trash me-1"></i> حذف
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-12 col-lg-4 mb-3">
                                    <div class="card border-danger">
                                        <div class="card-body">
                                            <h6 class="card-title text-danger">حذف جميع البيانات</h6>
                                            <p class="card-text small text-white">حذف كافة بيانات النظام</p>
                                            <button class="btn btn-danger btn-sm w-100" id="deleteAllBtn">
                                                <i class="fas fa-bomb me-1"></i> حذف الكل
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="alert alert-warning mt-3">
                                <i class="fas fa-exclamation-circle me-2"></i>
                                <strong>تحذير:</strong> عملية الحذف نهائية ولا يمكن استرجاع البيانات المحذوفة.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Request Details Modal -->
    <div class="modal fade" id="requestDetailsModal" tabindex="-1" aria-labelledby="requestDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="requestDetailsModalLabel">تفاصيل الطلب</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="requestDetailsContent">
                        <!-- سيتم ملؤها بواسطة JavaScript -->
                    </div>
                    
                    <div class="email-section mt-4">
                        <h6 class="text-primary mb-3">إرسال البيانات للمستخدم</h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="sendEmailAddress" class="form-label text-dark-bold">البريد الإلكتروني للإرسال</label>
                                <input type="email" class="form-control" id="sendEmailAddress" placeholder="user@domain.com">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="emailSubject" class="form-label text-dark-bold">عنوان الرسالة</label>
                                <input type="text" class="form-control" id="emailSubject" value="تفاصيل طلب إعادة تعيين كلمة المرور">
                            </div>
                        </div>
                        <div class="action-buttons-group">
                            <button class="btn btn-view" id="viewRequestBtn">
                                <i class="fas fa-eye me-2"></i> عرض الطلب
                            </button>
                            <button class="btn btn-download" id="downloadRequestBtn">
                                <i class="fas fa-download me-2"></i> تحميل ملف الطلب
                            </button>
                            <button class="btn btn-email" id="sendEmailBtn">
                                <i class="fas fa-envelope me-2"></i> إرسال بريد إلكتروني
                            </button>
                            <button class="btn btn-whatsapp" id="sendWhatsAppBtn">
                                <i class="fab fa-whatsapp me-2"></i> إرسال واتساب
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
                    <button type="button" class="btn btn-approve" id="approveBtn">موافقة</button>
                    <button type="button" class="btn btn-reject" id="rejectBtn">رفض</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Access Button -->
    <button class="admin-access-btn" id="adminAccessBtn">
        <i class="fas fa-user-shield fa-lg"></i>
        <span>دخول المشرف</span>
    </button>
    
    <!-- Footer -->
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-8 offset-md-2">
                    <h4 class="mb-3">جامعة المنيا - مركز تكنولوجيا المعلومات</h4>
                    <p class="mb-0">البوابة الإلكترونية - نظام إدارة طلبات إنشاء وإعادة تعيين كلمات المرور</p>
                    <div class="developer-info">
                        تصميم وتطوير: <strong>مهندس بولس سمير</strong> - وحدة تكنولوجيا المعلومات
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDwtS1DaHeGtBx9VULW9JoIqLJk8SvfXLM",
            authDomain: "emailreset-921d7.firebaseapp.com",
            databaseURL: "https://emailreset-921d7-default-rtdb.firebaseio.com",
            projectId: "emailreset-921d7",
            storageBucket: "emailreset-921d7.firebasestorage.app",
            messagingSenderId: "136829653902",
            appId: "1:136829653902:web:bf411d877e180da69d4adf"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Global Variables
        let requests = [];
        let isAdminLoggedIn = false;
        const ADMIN_PASSWORD = "85208520";
        let currentRequestId = null;
        let currentRequestFile = null;
        
        // DOM Elements
        const userInterface = document.getElementById('userInterface');
        const adminInterface = document.getElementById('adminInterface');
        const adminAccessBtn = document.getElementById('adminAccessBtn');
        const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
        const requestDetailsModal = new bootstrap.Modal(document.getElementById('requestDetailsModal'));
        const statsDetailsModal = new bootstrap.Modal(document.getElementById('statsDetailsModal'));
        
        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Load requests from Firebase
            loadRequests();
            
            // Setup main page buttons
            setupMainPage();
            
            // Admin access button
            adminAccessBtn.addEventListener('click', function() {
                loginModal.show();
            });
            
            // Admin login
            document.getElementById('loginBtn').addEventListener('click', function() {
                const password = document.getElementById('adminPassword').value;
                if (password === ADMIN_PASSWORD) {
                    isAdminLoggedIn = true;
                    userInterface.style.display = 'none';
                    adminInterface.style.display = 'block';
                    adminAccessBtn.style.display = 'none';
                    loginModal.hide();
                    updateStats();
                    loadEmailSettings();
                    showNotification('تم تسجيل الدخول بنجاح', 'success');
                } else {
                    showNotification('كلمة المرور غير صحيحة!', 'error');
                }
            });
            
            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', function() {
                isAdminLoggedIn = false;
                userInterface.style.display = 'block';
                adminInterface.style.display = 'none';
                adminAccessBtn.style.display = 'block';
                showNotification('تم تسجيل الخروج', 'info');
            });
            
            // Initialize email settings
            loadEmailSettings();
            
            // Setup operation type change listener
            setupOperationTypeListener();
            
            // Add floating particles (معدلة الحجم)
            createFloatingParticles();
        });
        
        // Create floating particles (تم تعديل حجمها)
        function createFloatingParticles() {
            const particlesContainer = document.createElement('div');
            particlesContainer.style.position = 'fixed';
            particlesContainer.style.top = '0';
            particlesContainer.style.left = '0';
            particlesContainer.style.width = '100%';
            particlesContainer.style.height = '100%';
            particlesContainer.style.pointerEvents = 'none';
            particlesContainer.style.zIndex = '0';
            document.body.appendChild(particlesContainer);
            
            const colors = [
                'rgba(38, 208, 206, 0.2)',  /* تم تخفيف العتامة */
                'rgba(142, 68, 173, 0.2)',  /* تم تخفيف العتامة */
                'rgba(30, 55, 153, 0.2)',   /* تم تخفيف العتامة */
                'rgba(255, 255, 255, 0.1)'  /* تم تخفيف العتامة */
            ];
            
            // عدد أقل من الكرات بحجم أصغر
            for (let i = 0; i < 15; i++) {
                const particle = document.createElement('div');
                particle.style.position = 'absolute';
                // حجم أصغر (3-8px بدلاً من 5-15px)
                particle.style.width = Math.random() * 5 + 3 + 'px';
                particle.style.height = particle.style.width;
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                particle.style.borderRadius = '50%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.boxShadow = '0 0 10px currentColor'; /* ظل أصغر */
                // حركة أبطأ
                particle.style.animation = `floatParticle ${Math.random() * 25 + 25}s linear infinite`;
                
                // Create keyframes for floating animation
                if (!document.querySelector('#particle-animation')) {
                    const style = document.createElement('style');
                    style.id = 'particle-animation';
                    style.textContent = `
                        @keyframes floatParticle {
                            0% {
                                transform: translate(0, 0) rotate(0deg);
                                opacity: ${Math.random() * 0.4 + 0.2}; /* عتامة أقل */
                            }
                            25% {
                                transform: translate(${Math.random() * 80 - 40}px, ${Math.random() * 80 - 40}px) rotate(90deg); /* حركة أقل */
                                opacity: ${Math.random() * 0.4 + 0.3};
                            }
                            50% {
                                transform: translate(${Math.random() * 80 - 40}px, ${Math.random() * 80 - 40}px) rotate(180deg);
                                opacity: ${Math.random() * 0.4 + 0.2};
                            }
                            75% {
                                transform: translate(${Math.random() * 80 - 40}px, ${Math.random() * 80 - 40}px) rotate(270deg);
                                opacity: ${Math.random() * 0.4 + 0.3};
                            }
                            100% {
                                transform: translate(0, 0) rotate(360deg);
                                opacity: ${Math.random() * 0.4 + 0.2};
                            }
                        }
                    `;
                    document.head.appendChild(style);
                }
                
                particlesContainer.appendChild(particle);
            }
        }
        
        // Setup Main Page
        function setupMainPage() {
            // New Request Button
            document.getElementById('newRequestBtn').addEventListener('click', function() {
                showSection('newRequestSection');
                setupNewRequestSection();
            });
            
            // Track Request Button
            document.getElementById('trackRequestBtn').addEventListener('click', function() {
                showSection('trackRequestSection');
                setupTrackRequestSection();
            });
            
            // Back to Main buttons
            document.getElementById('backToMainBtn')?.addEventListener('click', backToMain);
            document.getElementById('backToMainBtn2')?.addEventListener('click', backToMain);
            
            // Download form button
            document.getElementById('downloadFormBtn').addEventListener('click', downloadRequestForm);
            
            // Stats cards click listeners
            document.querySelectorAll('.stats-card').forEach(card => {
                card.addEventListener('click', function() {
                    const type = this.dataset.type;
                    showStatsDetails(type);
                });
            });
        }
        
        // Setup operation type listener
        function setupOperationTypeListener() {
            const createRadio = document.getElementById('createPassword');
            const resetRadio = document.getElementById('resetPassword');
            const createEmailField = document.getElementById('createEmailField');
            const resetEmailField = document.getElementById('resetEmailField');
            
            if (createRadio && resetRadio) {
                // Set initial state
                updateEmailFields(createRadio.checked ? 'create' : 'reset');
                
                // Add change listeners
                createRadio.addEventListener('change', function() {
                    if (this.checked) updateEmailFields('create');
                });
                
                resetRadio.addEventListener('change', function() {
                    if (this.checked) updateEmailFields('reset');
                });
            }
        }
        
        // Update email fields based on operation type
        function updateEmailFields(type) {
            const createEmailField = document.getElementById('createEmailField');
            const resetEmailField = document.getElementById('resetEmailField');
            const newEmailInput = document.getElementById('newEmail');
            const resetEmailInput = document.getElementById('resetEmail');
            
            if (type === 'create') {
                createEmailField.style.display = 'block';
                resetEmailField.style.display = 'none';
                newEmailInput.required = true;
                resetEmailInput.required = false;
                resetEmailInput.value = '';
            } else {
                createEmailField.style.display = 'none';
                resetEmailField.style.display = 'block';
                newEmailInput.required = false;
                resetEmailInput.required = true;
                newEmailInput.value = '';
            }
        }
        
        // Show Stats Details Modal
        function showStatsDetails(type) {
            let title = '';
            let content = '';
            
            switch(type) {
                case 'total':
                    title = 'تفاصيل جميع الطلبات';
                    content = generateTotalStatsContent();
                    break;
                case 'create':
                    title = 'تفاصيل طلبات الإنشاء';
                    content = generateCreateStatsContent();
                    break;
                case 'reset':
                    title = 'تفاصيل طلبات إعادة التعيين';
                    content = generateResetStatsContent();
                    break;
                case 'pending':
                    title = 'تفاصيل الطلبات المعلقة';
                    content = generatePendingStatsContent();
                    break;
                default:
                    title = 'تفاصيل الإحصائيات';
                    content = '<p class="text-center text-dark-bold">لا توجد بيانات متاحة</p>';
            }
            
            document.getElementById('statsDetailsModalLabel').textContent = title;
            document.getElementById('statsDetailsContent').innerHTML = content;
            
            // Setup export button
            document.getElementById('exportStatsBtn').onclick = function() {
                exportStatsData(type);
            };
            
            statsDetailsModal.show();
        }
        
        // Generate Total Stats Content
        function generateTotalStatsContent() {
            if (requests.length === 0) {
                return '<p class="text-center text-dark-bold">لا توجد طلبات بعد</p>';
            }
            
            let html = `
                <div class="table-responsive">
                    <table class="stats-modal-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>اسم العضو</th>
                                <th>الرقم القومي</th>
                                <th>نوع العملية</th>
                                <th>البريد الإلكتروني</th>
                                <th>الحالة</th>
                                <th>التاريخ</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            requests.forEach((request, index) => {
                let statusBadge = '';
                if (request.status === 'approved') {
                    statusBadge = '<span class="badge bg-success">تمت الموافقة</span>';
                } else if (request.status === 'rejected') {
                    statusBadge = '<span class="badge bg-danger">مرفوض</span>';
                } else {
                    statusBadge = '<span class="badge bg-warning">قيد الانتظار</span>';
                }
                
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td class="text-dark-bold">${request.staffName}</td>
                        <td>${request.nationalId}</td>
                        <td>${request.operationType === 'create' ? 'إنشاء' : 'إعادة تعيين'}</td>
                        <td>${request.emailAddress || request.contactEmail || 'غير محدد'}</td>
                        <td>${statusBadge}</td>
                        <td>${new Date(request.timestamp).toLocaleDateString('ar-EG')}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
                <div class="mt-3">
                    <p class="text-dark-bold"><strong>إجمالي الطلبات:</strong> ${requests.length}</p>
                    <p class="text-dark-bold"><strong>طلبات الإنشاء:</strong> ${requests.filter(r => r.operationType === 'create').length}</p>
                    <p class="text-dark-bold"><strong>طلبات إعادة التعيين:</strong> ${requests.filter(r => r.operationType === 'reset').length}</p>
                    <p class="text-dark-bold"><strong>الطلبات المعلقة:</strong> ${requests.filter(r => r.status === 'pending').length}</p>
                    <p class="text-dark-bold"><strong>الطلبات الموافق عليها:</strong> ${requests.filter(r => r.status === 'approved').length}</p>
                    <p class="text-dark-bold"><strong>الطلبات المرفوضة:</strong> ${requests.filter(r => r.status === 'rejected').length}</p>
                </div>
            `;
            
            return html;
        }
        
        // Generate Create Stats Content
        function generateCreateStatsContent() {
            const createRequests = requests.filter(r => r.operationType === 'create');
            
            if (createRequests.length === 0) {
                return '<p class="text-center text-dark-bold">لا توجد طلبات إنشاء بعد</p>';
            }
            
            let html = `
                <div class="table-responsive">
                    <table class="stats-modal-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>اسم العضو</th>
                                <th>الرقم القومي</th>
                                <th>البريد المقترح</th>
                                <th>الحالة</th>
                                <th>التاريخ</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            createRequests.forEach((request, index) => {
                let statusBadge = '';
                if (request.status === 'approved') {
                    statusBadge = '<span class="badge bg-success">تمت الموافقة</span>';
                } else if (request.status === 'rejected') {
                    statusBadge = '<span class="badge bg-danger">مرفوض</span>';
                } else {
                    statusBadge = '<span class="badge bg-warning">قيد الانتظار</span>';
                }
                
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td class="text-dark-bold">${request.staffName}</td>
                        <td>${request.nationalId}</td>
                        <td>${request.emailAddress || request.contactEmail || 'غير محدد'}</td>
                        <td>${statusBadge}</td>
                        <td>${new Date(request.timestamp).toLocaleDateString('ar-EG')}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
                <div class="mt-3">
                    <p class="text-dark-bold"><strong>إجمالي طلبات الإنشاء:</strong> ${createRequests.length}</p>
                    <p class="text-dark-bold"><strong>طلبات الإنشاء المعلقة:</strong> ${createRequests.filter(r => r.status === 'pending').length}</p>
                    <p class="text-dark-bold"><strong>طلبات الإنشاء الموافق عليها:</strong> ${createRequests.filter(r => r.status === 'approved').length}</p>
                    <p class="text-dark-bold"><strong>طلبات الإنشاء المرفوضة:</strong> ${createRequests.filter(r => r.status === 'rejected').length}</p>
                </div>
            `;
            
            return html;
        }
        
        // Generate Reset Stats Content
        function generateResetStatsContent() {
            const resetRequests = requests.filter(r => r.operationType === 'reset');
            
            if (resetRequests.length === 0) {
                return '<p class="text-center text-dark-bold">لا توجد طلبات إعادة تعيين بعد</p>';
            }
            
            let html = `
                <div class="table-responsive">
                    <table class="stats-modal-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>اسم العضو</th>
                                <th>الرقم القومي</th>
                                <th>البريد المراد إعادة تعيينه</th>
                                <th>الحالة</th>
                                <th>التاريخ</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            resetRequests.forEach((request, index) => {
                let statusBadge = '';
                if (request.status === 'approved') {
                    statusBadge = '<span class="badge bg-success">تمت الموافقة</span>';
                } else if (request.status === 'rejected') {
                    statusBadge = '<span class="badge bg-danger">مرفوض</span>';
                } else {
                    statusBadge = '<span class="badge bg-warning">قيد الانتظار</span>';
                }
                
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td class="text-dark-bold">${request.staffName}</td>
                        <td>${request.nationalId}</td>
                        <td>${request.emailAddress || request.contactEmail || 'غير محدد'}</td>
                        <td>${statusBadge}</td>
                        <td>${new Date(request.timestamp).toLocaleDateString('ar-EG')}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
                <div class="mt-3">
                    <p class="text-dark-bold"><strong>إجمالي طلبات إعادة التعيين:</strong> ${resetRequests.length}</p>
                    <p class="text-dark-bold"><strong>طلبات إعادة التعيين المعلقة:</strong> ${resetRequests.filter(r => r.status === 'pending').length}</p>
                    <p class="text-dark-bold"><strong>طلبات إعادة التعيين الموافق عليها:</strong> ${resetRequests.filter(r => r.status === 'approved').length}</p>
                    <p class="text-dark-bold"><strong>طلبات إعادة التعيين المرفوضة:</strong> ${resetRequests.filter(r => r.status === 'rejected').length}</p>
                </div>
            `;
            
            return html;
        }
        
        // Generate Pending Stats Content
        function generatePendingStatsContent() {
            const pendingRequests = requests.filter(r => r.status === 'pending');
            
            if (pendingRequests.length === 0) {
                return '<p class="text-center text-dark-bold">لا توجد طلبات معلقة</p>';
            }
            
            let html = `
                <div class="table-responsive">
                    <table class="stats-modal-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>اسم العضو</th>
                                <th>الرقم القومي</th>
                                <th>نوع العملية</th>
                                <th>البريد الإلكتروني</th>
                                <th>التاريخ</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            pendingRequests.forEach((request, index) => {
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td class="text-dark-bold">${request.staffName}</td>
                        <td>${request.nationalId}</td>
                        <td>${request.operationType === 'create' ? 'إنشاء' : 'إعادة تعيين'}</td>
                        <td>${request.emailAddress || request.contactEmail || 'غير محدد'}</td>
                        <td>${new Date(request.timestamp).toLocaleDateString('ar-EG')}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
                <div class="mt-3">
                    <p class="text-dark-bold"><strong>إجمالي الطلبات المعلقة:</strong> ${pendingRequests.length}</p>
                    <p class="text-dark-bold"><strong>طلبات الإنشاء المعلقة:</strong> ${pendingRequests.filter(r => r.operationType === 'create').length}</p>
                    <p class="text-dark-bold"><strong>طلبات إعادة التعيين المعلقة:</strong> ${pendingRequests.filter(r => r.operationType === 'reset').length}</p>
                </div>
            `;
            
            return html;
        }
        
        // Export Stats Data
        function exportStatsData(type) {
            let dataToExport = [];
            let filename = '';
            
            switch(type) {
                case 'total':
                    dataToExport = requests;
                    filename = 'جميع_الطلبات';
                    break;
                case 'create':
                    dataToExport = requests.filter(r => r.operationType === 'create');
                    filename = 'طلبات_الإنشاء';
                    break;
                case 'reset':
                    dataToExport = requests.filter(r => r.operationType === 'reset');
                    filename = 'طلبات_إعادة_التعيين';
                    break;
                case 'pending':
                    dataToExport = requests.filter(r => r.status === 'pending');
                    filename = 'الطلبات_المعلقة';
                    break;
            }
            
            if (dataToExport.length === 0) {
                showNotification('لا توجد بيانات للتصدير', 'warning');
                return;
            }
            
            // Create CSV content
            let csvContent = "data:text/csv;charset=utf-8,\uFEFF";
            csvContent += "رقم,اسم العضو,الرقم القومي,نوع العملية,البريد الإلكتروني,الحالة,تاريخ الطلب\n";
            
            dataToExport.forEach((request, index) => {
                const row = [
                    index + 1,
                    `أ.د/ ${request.staffName}`,
                    request.nationalId,
                    request.operationType === 'create' ? 'إنشاء' : 'إعادة تعيين',
                    request.emailAddress || request.contactEmail || 'غير محدد',
                    request.status === 'approved' ? 'تمت الموافقة' : request.status === 'rejected' ? 'مرفوض' : 'قيد الانتظار',
                    new Date(request.timestamp).toLocaleDateString('ar-EG')
                ];
                csvContent += row.join(",") + "\n";
            });
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", filename + "_" + new Date().toISOString().split('T')[0] + ".csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('تم تصدير البيانات بنجاح', 'success');
        }
        
        // Show specific section
        function showSection(sectionId) {
            // Hide all sections
            document.getElementById('newRequestSection').style.display = 'none';
            document.getElementById('trackRequestSection').style.display = 'none';
            
            // Show requested section
            document.getElementById(sectionId).style.display = 'block';
            
            // Add animation
            const section = document.getElementById(sectionId);
            section.classList.add('animate__animated', 'animate__fadeIn');
        }
        
        // Back to main page
        function backToMain() {
            document.getElementById('newRequestSection').style.display = 'none';
            document.getElementById('trackRequestSection').style.display = 'none';
        }
        
        // Setup New Request Section
        function setupNewRequestSection() {
            const requestForm = document.getElementById('requestForm');
            if (!requestForm) return;
            
            // Reset form
            requestForm.reset();
            
            // Hide file info
            const fileInfo = document.getElementById('fileInfo');
            if (fileInfo) fileInfo.style.display = 'none';
            
            // Reset operation type fields
            updateEmailFields('create');
            
            // File upload
            const requestFileInput = document.getElementById('requestFile');
            if (requestFileInput) {
                requestFileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        // Store the file globally for later use
                        currentRequestFile = file;
                        
                        // Show file info
                        const fileInfo = document.getElementById('fileInfo');
                        fileInfo.innerHTML = `
                            <i class="fas fa-file me-1"></i>
                            <strong>${file.name}</strong> (${formatFileSize(file.size)})
                            <br>
                            <small>نوع الملف: ${file.type || 'غير معروف'}</small>
                        `;
                        fileInfo.style.display = 'block';
                    }
                });
            }
            
            // Choose file button
            const chooseFileBtn = document.getElementById('chooseFileBtn');
            if (chooseFileBtn) {
                chooseFileBtn.addEventListener('click', function() {
                    requestFileInput.click();
                });
            }
            
            // Form submit
            if (requestForm) {
                requestForm.onsubmit = function(e) {
                    e.preventDefault();
                    submitRequest();
                };
            }
        }
        
        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 ب';
            const k = 1024;
            const sizes = ['ب', 'ك.ب', 'م.ب', 'ج.ب'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // Setup Track Request Section
        function setupTrackRequestSection() {
            const trackBtn = document.getElementById('trackBtn');
            if (trackBtn) {
                trackBtn.onclick = trackRequests;
            }
        }
        
        // Download Request Form
        function downloadRequestForm() {
            const formUrl = "https://drive.google.com/uc?export=download&id=1IEcan3fp_xo3APu1PQ5D2P8U1wXjm7tI";
            const link = document.createElement('a');
            link.href = formUrl;
            link.download = "نموذج_طلب_إنشاء_إعادة_تعيين_كلمة_المرور.pdf";
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showNotification('تم بدء تحميل النموذج', 'info');
        }
        
        // Submit Request Function
        async function submitRequest() {
            const staffName = document.getElementById('staffName')?.value || '';
            const nationalId = document.getElementById('nationalId')?.value || '';
            const mobileNumber = document.getElementById('mobileNumber')?.value || '';
            const contactEmail = document.getElementById('contactEmail')?.value || '';
            const operationType = document.querySelector('input[name="operationType"]:checked')?.value || '';
            const requestFile = document.getElementById('requestFile')?.files[0];
            
            let emailAddress = '';
            if (operationType === 'create') {
                const newEmail = document.getElementById('newEmail')?.value || '';
                if (newEmail) {
                    emailAddress = newEmail + '@mu.edu.eg';
                }
            } else {
                emailAddress = document.getElementById('resetEmail')?.value || '';
            }
            
            // Validate
            if (!staffName || !nationalId || !mobileNumber || !contactEmail || !requestFile) {
                showNotification('يرجى ملء جميع الحقول المطلوبة!', 'warning');
                return;
            }
            
            // Validate national ID
            if (!/^\d{14}$/.test(nationalId)) {
                showNotification('الرقم القومي يجب أن يتكون من 14 رقمًا!', 'warning');
                return;
            }
            
            // Validate mobile number
            if (!/^01[0-9]{9}$/.test(mobileNumber)) {
                showNotification('رقم الهاتف يجب أن يبدأ بـ 01 ويتكون من 11 رقمًا!', 'warning');
                return;
            }
            
            // Validate contact email
            if (!validateEmail(contactEmail)) {
                showNotification('البريد الإلكتروني للتواصل غير صحيح!', 'warning');
                return;
            }
            
            // Validate email address based on operation type
            if (operationType === 'create') {
                const newEmail = document.getElementById('newEmail')?.value || '';
                if (!newEmail) {
                    showNotification('يرجى إدخال اسم المستخدم للبريد الإلكتروني الجديد!', 'warning');
                    return;
                }
                if (!/^[a-zA-Z0-9._-]+$/.test(newEmail)) {
                    showNotification('اسم المستخدم يجب أن يحتوي على أحرف إنجليزية وأرقام ونقاط وشرطات فقط!', 'warning');
                    return;
                }
            } else {
                if (!emailAddress) {
                    showNotification('يرجى إدخال البريد الإلكتروني المراد إعادة تعيينه!', 'warning');
                    return;
                }
                if (!validateEmail(emailAddress)) {
                    showNotification('البريد الإلكتروني غير صحيح!', 'warning');
                    return;
                }
                if (!emailAddress.endsWith('@mu.edu.eg')) {
                    showNotification('البريد الإلكتروني يجب أن ينتهي بـ @mu.edu.eg', 'warning');
                    return;
                }
            }
            
            // Generate unique ID
            const requestId = Date.now().toString();
            
            // Show loading
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i> جاري الإرسال...';
            submitBtn.disabled = true;
            
            try {
                // Step 1: Generate a random password
                const generatedPassword = generatePassword();
                
                // Step 2: Read file as base64
                const fileBase64 = await readFileAsBase64(requestFile);
                
                // Step 3: Prepare request data
                const requestData = {
                    staffName: staffName,
                    nationalId: nationalId,
                    mobileNumber: mobileNumber,
                    contactEmail: contactEmail,
                    emailAddress: emailAddress,
                    operationType: operationType,
                    fileName: `${staffName}_${operationType}_${new Date().toISOString().split('T')[0]}_${requestFile.name}`,
                    fileType: requestFile.type,
                    fileSize: requestFile.size,
                    fileData: fileBase64, // Store file as base64
                    generatedPassword: generatedPassword,
                    timestamp: new Date().toISOString(),
                    status: 'pending',
                    adminAction: null,
                    adminActionDate: null
                };
                
                // Step 4: Save to Firebase
                await database.ref('requests/' + requestId).set(requestData);
                
                // Step 5: Show success
                showNotification('تم إرسال الطلب بنجاح! سيتم ارسال الباسورد عبر البريد الإلكتروني والواتس المسجل بالطلب', 'success');
                
                // Step 6: Reset form and go back to main
                document.getElementById('requestForm').reset();
                document.getElementById('fileInfo').style.display = 'none';
                updateEmailFields('create');
                backToMain();
                
                // Step 7: Update stats
                loadRequests();
                
            } catch (error) {
                console.error('Error submitting request:', error);
                showNotification('حدث خطأ أثناء إرسال الطلب: ' + error.message, 'error');
            } finally {
                // Restore button
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }
        
        // Read file as base64
        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    resolve(e.target.result);
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        // Generate random password
        function generatePassword() {
            const length = 12;
            const charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";
            let password = "";
            for (let i = 0; i < length; i++) {
                password += charset.charAt(Math.floor(Math.random() * charset.length));
            }
            return password;
        }
        
        // Validate email
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        
        // Track Requests
        function trackRequests() {
            const nationalId = document.getElementById('trackNationalId')?.value.trim() || '';
            
            if (!/^\d{14}$/.test(nationalId)) {
                showNotification('الرجاء إدخال رقم قومي صحيح (14 رقمًا)', 'warning');
                return;
            }
            
            const userRequests = requests.filter(r => r.nationalId === nationalId);
            const resultsDiv = document.getElementById('trackResults');
            
            if (userRequests.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="text-center text-white py-5">
                        <i class="fas fa-search fa-4x mb-4 opacity-50"></i>
                        <h4 class="mb-3">لا توجد طلبات لهذا الرقم القومي</h4>
                        <p class="mb-0">الرقم القومي: ${nationalId}</p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <h4 class="text-white mb-4">الطلبات الخاصة بالرقم القومي: ${nationalId}</h4>
                <div class="row">
            `;
            
            userRequests.forEach((request, index) => {
                let statusClass = '';
                let statusText = '';
                let statusIcon = '';
                
                if (request.status === 'approved') {
                    statusClass = 'bg-success';
                    statusText = 'تمت الموافقة';
                    statusIcon = 'fa-check-circle';
                } else if (request.status === 'rejected') {
                    statusClass = 'bg-danger';
                    statusText = 'مرفوض';
                    statusIcon = 'fa-times-circle';
                } else {
                    statusClass = 'bg-warning';
                    statusText = 'قيد الانتظار';
                    statusIcon = 'fa-clock';
                }
                
                html += `
                    <div class="col-md-6 mb-4">
                        <div class="glass-container">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <h5 class="text-white mb-0">طلب ${index + 1}</h5>
                                <span class="status-badge ${statusClass}">
                                    <i class="fas ${statusIcon} me-1"></i> ${statusText}
                                </span>
                            </div>
                            
                            <div class="row">
                                <div class="col-6">
                                    <p class="text-white-50 mb-1">اسم العضو:</p>
                                    <p class="text-white text-black-bold">${request.staffName}</p>
                                </div>
                                <div class="col-6">
                                    <p class="text-white-50 mb-1">نوع العملية:</p>
                                    <p class="text-white">${request.operationType === 'create' ? 'إنشاء' : 'إعادة تعيين'}</p>
                                </div>
                                <div class="col-6">
                                    <p class="text-white-50 mb-1">البريد الإلكتروني:</p>
                                    <p class="text-white">${request.emailAddress || request.contactEmail || 'غير محدد'}</p>
                                </div>
                                <div class="col-6">
                                    <p class="text-white-50 mb-1">التاريخ:</p>
                                    <p class="text-white">${new Date(request.timestamp).toLocaleDateString('ar-EG')}</p>
                                </div>
                                <div class="col-6">
                                    <p class="text-white-50 mb-1">الحالة:</p>
                                    <p class="text-white">${statusText}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += `</div>`;
            resultsDiv.innerHTML = html;
        }
        
        // Load Requests from Firebase
        function loadRequests() {
            const requestsRef = database.ref('requests');
            
            requestsRef.on('value', (snapshot) => {
                requests = [];
                const data = snapshot.val();
                
                if (data) {
                    Object.keys(data).forEach((key) => {
                        requests.push({
                            id: key,
                            ...data[key]
                        });
                    });
                    
                    // Sort by timestamp (newest first)
                    requests.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    
                    // Update admin tables
                    updateAdminTables();
                    
                    // Update stats
                    updateStats();
                }
            });
        }
        
        // Update Admin Tables (تم التعديل لإضافة أيقونات)
        function updateAdminTables() {
            // Pending requests
            const pendingRequests = requests.filter(r => r.status === 'pending');
            updateTable('pendingTableBody', pendingRequests, 'pending');
            
            // Approved requests
            const approvedRequests = requests.filter(r => r.status === 'approved');
            updateTable('approvedTableBody', approvedRequests, 'approved');
            
            // Rejected requests
            const rejectedRequests = requests.filter(r => r.status === 'rejected');
            updateTable('rejectedTableBody', rejectedRequests, 'rejected');
        }
        
        // Update Table (تم التعديل لإضافة أيقونات للإجراءات)
        function updateTable(tableBodyId, tableRequests, type) {
            const tableBody = document.getElementById(tableBodyId);
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            
            if (tableRequests.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center py-4">
                            <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                            <p class="mb-0">لا توجد طلبات</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tableRequests.forEach((request, index) => {
                const row = document.createElement('tr');
                
                // Determine action buttons based on type
                let actionButtons = '';
                
                if (type === 'pending') {
                    // أزرار كاملة للمعلقة
                    actionButtons = `
                        <div class="action-icons-container">
                            <button class="btn-icon btn-icon-view view-details-btn" data-id="${request.id}" title="عرض التفاصيل">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-icon btn-approve approve-btn" data-id="${request.id}" title="موافقة">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="btn-icon btn-reject reject-btn" data-id="${request.id}" title="رفض">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    `;
                } else if (type === 'approved') {
                    // أيقونات فقط للموافق عليها
                    actionButtons = `
                        <div class="action-icons-container">
                            <button class="btn-icon btn-icon-view view-details-btn" data-id="${request.id}" title="عرض التفاصيل">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-icon btn-icon-download download-request-btn" data-id="${request.id}" title="تحميل الطلب">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="btn-icon btn-icon-email email-request-btn" data-id="${request.id}" title="إرسال بريد">
                                <i class="fas fa-envelope"></i>
                            </button>
                            <button class="btn-icon btn-icon-whatsapp whatsapp-request-btn" data-id="${request.id}" title="إرسال واتساب">
                                <i class="fab fa-whatsapp"></i>
                            </button>
                        </div>
                    `;
                } else {
                    // للمرفوضة فقط عرض التفاصيل
                    actionButtons = `
                        <div class="action-icons-container">
                            <button class="btn-icon btn-icon-view view-details-btn" data-id="${request.id}" title="عرض التفاصيل">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    `;
                }
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${request.staffName}</td>
                    <td>${request.nationalId}</td>
                    <td>
                        <span class="badge ${request.operationType === 'create' ? 'bg-success' : 'bg-danger'}">
                            ${request.operationType === 'create' ? 'إنشاء' : 'إعادة تعيين'}
                        </span>
                    </td>
                    <td>${request.emailAddress || request.contactEmail || 'غير محدد'}</td>
                    <td>${type === 'pending' ? 
                        new Date(request.timestamp).toLocaleDateString('ar-EG') : 
                        new Date(request.adminActionDate || request.timestamp).toLocaleDateString('ar-EG')}
                    </td>
                    <td>
                        ${actionButtons}
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Add event listeners
            addTableEventListeners();
        }
        
        // Add Table Event Listeners (تم التعديل)
        function addTableEventListeners() {
            // View details buttons
            document.querySelectorAll('.view-details-btn').forEach(button => {
                button.addEventListener('click', function() {
                    currentRequestId = this.dataset.id;
                    showRequestDetailsModal(currentRequestId);
                });
            });
            
            // Approve buttons
            document.querySelectorAll('.approve-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const requestId = this.dataset.id;
                    updateRequestStatus(requestId, 'approved');
                });
            });
            
            // Reject buttons
            document.querySelectorAll('.reject-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const requestId = this.dataset.id;
                    updateRequestStatus(requestId, 'rejected');
                });
            });
            
            // Download request buttons (للموافق عليها)
            document.querySelectorAll('.download-request-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const requestId = this.dataset.id;
                    const request = requests.find(r => r.id === requestId);
                    if (request) {
                        downloadRequestFile(request);
                    }
                });
            });
            
            // Email request buttons (للموافق عليها)
            document.querySelectorAll('.email-request-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const requestId = this.dataset.id;
                    const request = requests.find(r => r.id === requestId);
                    if (request) {
                        sendEmailMessageFromTable(request);
                    }
                });
            });
            
            // WhatsApp request buttons (للموافق عليها)
            document.querySelectorAll('.whatsapp-request-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const requestId = this.dataset.id;
                    const request = requests.find(r => r.id === requestId);
                    if (request) {
                        sendWhatsAppMessage(request);
                    }
                });
            });
            
            // Download all button
            document.getElementById('downloadAllBtn')?.addEventListener('click', function() {
                downloadAllRequests();
            });
            
            // Refresh buttons
            document.getElementById('refreshPendingBtn')?.addEventListener('click', loadRequests);
            document.getElementById('refreshApprovedBtn')?.addEventListener('click', loadRequests);
            document.getElementById('refreshRejectedBtn')?.addEventListener('click', loadRequests);
            
            // Save email settings
            document.getElementById('saveEmailSettings')?.addEventListener('click', saveEmailSettings);
            
            // Export buttons
            document.getElementById('exportAllData')?.addEventListener('click', exportAllData);
            document.getElementById('exportAllPDF')?.addEventListener('click', exportAllPDF);
            
            // Delete buttons
            document.getElementById('deleteRejectedBtn')?.addEventListener('click', function() {
                if (confirm('هل أنت متأكد من حذف جميع الطلبات المرفوضة؟')) {
                    deleteRejectedRequests();
                }
            });
            
            document.getElementById('deleteOldBtn')?.addEventListener('click', function() {
                if (confirm('هل أنت متأكد من حذف الطلبات القديمة (أكثر من 30 يوم)؟')) {
                    deleteOldRequests();
                }
            });
            
            document.getElementById('deleteAllBtn')?.addEventListener('click', function() {
                if (confirm('هل أنت متأكد من حذف كافة البيانات؟ هذا الإجراء لا يمكن التراجع عنه!')) {
                    deleteAllRequests();
                }
            });
        }
        
        // Send Email Message from Table (بدون فتح المودال)
        function sendEmailMessageFromTable(request) {
            if (!request.contactEmail) {
                showNotification('لا يوجد بريد إلكتروني للعضو', 'warning');
                return;
            }
            
            // Create email body
            const emailBody = `نفيد علم سيادتكم تم ${request.operationType === 'create' ? 'إنشاء' : 'إعادة تعيين'} الباسورد الخاصة بسيادتكم وبيانتكم كالتالي

اسم العضو أ.د: ${request.staffName}
${request.operationType === 'create' ? 'البريد الإلكتروني الجديد:' : 'البريد الإلكتروني:'} ${request.emailAddress || request.contactEmail}
${request.generatedPassword ? `الباسورد: ${request.generatedPassword}` : 'لم يتم توليد كلمة مرور بعد'}
الرقم القومي: ${request.nationalId}

برجاء ادخال الباسورد وتغيرها عند اول دخول علي الايميل

شكرا لسيادتكم
مهندس بولس سمير
مدير وحدة تكنولوجيا المعلومات
جامعة المنيا`;
            
            // Create mailto link
            const mailtoLink = `mailto:${request.contactEmail}?subject=تفاصيل طلب إعادة تعيين كلمة المرور&body=${encodeURIComponent(emailBody)}`;
            
            // Open email client
            window.location.href = mailtoLink;
            
            showNotification('تم فتح بريدك الإلكتروني لإرسال الرسالة', 'info');
        }
        
        // Show Request Details Modal
        function showRequestDetailsModal(requestId) {
            const request = requests.find(r => r.id === requestId);
            if (!request) return;
            
            const detailsContent = document.getElementById('requestDetailsContent');
            
            // Format status
            let statusBadge = '';
            if (request.status === 'approved') {
                statusBadge = '<span class="badge bg-success">تمت الموافقة</span>';
            } else if (request.status === 'rejected') {
                statusBadge = '<span class="badge bg-danger">مرفوض</span>';
            } else {
                statusBadge = '<span class="badge bg-warning">قيد الانتظار</span>';
            }
            
            detailsContent.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label text-dark-bold"><strong>رقم الطلب:</strong></label>
                            <p class="mb-0">${request.id}</p>
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-dark-bold"><strong>اسم عضو هيئة التدريس:</strong></label>
                            <p class="mb-0">أ.د/ ${request.staffName}</p>
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-dark-bold"><strong>الرقم القومي:</strong></label>
                            <p class="mb-0">${request.nationalId}</p>
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-dark-bold"><strong>رقم الهاتف:</strong></label>
                            <p class="mb-0">${request.mobileNumber}</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label text-dark-bold"><strong>البريد الإلكتروني للتواصل:</strong></label>
                            <p class="mb-0">${request.contactEmail}</p>
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-dark-bold"><strong>نوع العملية:</strong></label>
                            <p class="mb-0">
                                <span class="badge ${request.operationType === 'create' ? 'bg-success' : 'bg-danger'}">
                                    ${request.operationType === 'create' ? 'إنشاء بريد إلكتروني جديد' : 'إعادة تعيين كلمة المرور'}
                                </span>
                            </p>
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-dark-bold"><strong>البريد الإلكتروني:</strong></label>
                            <p class="mb-0">${request.emailAddress || 'غير محدد'}</p>
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-dark-bold"><strong>تاريخ الطلب:</strong></label>
                            <p class="mb-0">${new Date(request.timestamp).toLocaleString('ar-EG')}</p>
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-dark-bold"><strong>الحالة:</strong></label>
                            <p class="mb-0">${statusBadge}</p>
                        </div>
                    </div>
                </div>
                
                ${request.fileName ? `
                <div class="alert alert-info mt-3">
                    <i class="fas fa-file me-2"></i>
                    <strong>ملف الطلب الموقع:</strong>
                    <p class="mb-0 mt-2">${request.fileName} (${formatFileSize(request.fileSize || 0)})</p>
                </div>
                ` : ''}
                
                ${request.generatedPassword ? `
                <div class="alert alert-success mt-3">
                    <i class="fas fa-key me-2"></i>
                    <strong>كلمة المرور المولدة:</strong>
                    <p class="mb-0 mt-2" style="font-size: 1.2rem; font-weight: bold;">${request.generatedPassword}</p>
                </div>
                ` : ''}
                
                ${request.adminAction ? `
                <div class="alert ${request.adminAction === 'approved' ? 'alert-success' : 'alert-danger'} mt-3">
                    <i class="fas ${request.adminAction === 'approved' ? 'fa-check-circle' : 'fa-times-circle'} me-2"></i>
                    <strong>تم ${request.adminAction === 'approved' ? 'الموافقة' : 'الرفض'} على الطلب</strong>
                    <br>
                    <small>التاريخ: ${new Date(request.adminActionDate).toLocaleDateString('ar-EG')}</small>
                </div>
                ` : ''}
            `;
            
            // Set email field to contact email
            document.getElementById('sendEmailAddress').value = request.contactEmail;
            
            // Show/hide buttons based on status
            if (request.status === 'pending') {
                document.getElementById('approveBtn').style.display = 'inline-block';
                document.getElementById('rejectBtn').style.display = 'inline-block';
            } else {
                document.getElementById('approveBtn').style.display = 'none';
                document.getElementById('rejectBtn').style.display = 'none';
            }
            
            // Add event listeners to modal buttons
            document.getElementById('approveBtn').onclick = function() {
                updateRequestStatus(requestId, 'approved');
                requestDetailsModal.hide();
            };
            
            document.getElementById('rejectBtn').onclick = function() {
                updateRequestStatus(requestId, 'rejected');
                requestDetailsModal.hide();
            };
            
            document.getElementById('viewRequestBtn').onclick = function() {
                viewRequestFile(request);
            };
            
            document.getElementById('downloadRequestBtn').onclick = function() {
                downloadRequestFile(request);
            };
            
            document.getElementById('sendEmailBtn').onclick = function() {
                sendEmailMessage(request);
            };
            
            document.getElementById('sendWhatsAppBtn').onclick = function() {
                sendWhatsAppMessage(request);
            };
            
            // Show modal
            requestDetailsModal.show();
        }
        
        // Update Request Status
        async function updateRequestStatus(requestId, status) {
            try {
                const request = requests.find(r => r.id === requestId);
                if (!request) return;
                
                const updates = {
                    status: status,
                    adminAction: status,
                    adminActionDate: new Date().toISOString()
                };
                
                await database.ref('requests/' + requestId).update(updates);
                
                showNotification(`تم ${status === 'approved' ? 'الموافقة' : 'الرفض'} على الطلب بنجاح`, 'success');
                
                // Reload requests
                loadRequests();
                
            } catch (error) {
                console.error('Error updating request status:', error);
                showNotification('حدث خطأ أثناء تحديث حالة الطلب', 'error');
            }
        }
        
        // View Request File
        function viewRequestFile(request) {
            if (!request.fileData) {
                showNotification('لا يوجد ملف للطلب', 'warning');
                return;
            }
            
            // Create a new window to view the file
            const win = window.open('');
            win.document.write(`
                <!DOCTYPE html>
                <html dir="rtl" lang="ar">
                <head>
                    <meta charset="UTF-8">
                    <title>عرض ملف الطلب: ${request.fileName}</title>
                    <style>
                        body {
                            font-family: 'Cairo', sans-serif;
                            padding: 20px;
                            background: #f0f2f5;
                        }
                        .header {
                            background: linear-gradient(135deg, #0c2461, #1e3799);
                            color: white;
                            padding: 20px;
                            border-radius: 15px;
                            margin-bottom: 20px;
                            text-align: center;
                        }
                        .file-content {
                            background: white;
                            padding: 30px;
                            border-radius: 15px;
                            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                            margin-top: 20px;
                        }
                        .file-info {
                            background: #f8f9fa;
                            padding: 15px;
                            border-radius: 10px;
                            margin-bottom: 20px;
                        }
                        .btn {
                            padding: 10px 20px;
                            border: none;
                            border-radius: 10px;
                            cursor: pointer;
                            font-weight: bold;
                            margin: 5px;
                        }
                        .btn-primary {
                            background: #0c2461;
                            color: white;
                        }
                        .btn-secondary {
                            background: #6c757d;
                            color: white;
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h2>ملف الطلب الموقع</h2>
                        <p>اسم الملف: ${request.fileName}</p>
                    </div>
                    
                    <div class="file-info">
                        <p><strong>اسم العضو:</strong> أ.د/ ${request.staffName}</p>
                        <p><strong>الرقم القومي:</strong> ${request.nationalId}</p>
                        <p><strong>نوع العملية:</strong> ${request.operationType === 'create' ? 'إنشاء' : 'إعادة تعيين'}</p>
                        <p><strong>حجم الملف:</strong> ${formatFileSize(request.fileSize || 0)}</p>
                    </div>
                    
                    <div class="file-content">
                        <h4>معاينة الملف:</h4>
                        ${request.fileType.startsWith('image/') ? 
                            `<img src="${request.fileData}" style="max-width: 100%; border-radius: 10px;" alt="صورة الطلب">` : 
                            `<p>هذا الملف ليس صورة. يمكنك تحميله لعرضه.</p>`
                        }
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn btn-primary" onclick="window.print()">
                            <i class="fas fa-print"></i> طباعة
                        </button>
                        <button class="btn btn-secondary" onclick="window.close()">
                            <i class="fas fa-times"></i> إغلاق
                        </button>
                    </div>
                </body>
                </html>
            `);
        }
        
        // Download Request File
        function downloadRequestFile(request) {
            if (!request.fileData) {
                showNotification('لا يوجد ملف للطلب', 'warning');
                return;
            }
            
            // Convert base64 to blob
            const byteCharacters = atob(request.fileData.split(',')[1]);
            const byteNumbers = new Array(byteCharacters.length);
            for (let i = 0; i < byteCharacters.length; i++) {
                byteNumbers[i] = byteCharacters.charCodeAt(i);
            }
            const byteArray = new Uint8Array(byteNumbers);
            const blob = new Blob([byteArray], { type: request.fileType });
            
            // Create download link
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = request.fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);
            
            showNotification('تم تحميل ملف الطلب بنجاح', 'success');
        }
        
        // Send WhatsApp Message
        function sendWhatsAppMessage(request) {
            if (!request.mobileNumber) {
                showNotification('لا يوجد رقم هاتف للعضو', 'warning');
                return;
            }
            
            // Format mobile number for WhatsApp (Egyptian numbers)
            let mobileNumber = request.mobileNumber;
            
            // Remove leading 0 and add +20 for Egypt
            if (mobileNumber.startsWith('0')) {
                mobileNumber = '20' + mobileNumber.substring(1);
            }
            
            // Create WhatsApp message
            const message = `نفيد علم سيادتكم تم ${request.operationType === 'create' ? 'إنشاء' : 'إعادة تعيين'} الباسورد الخاصة بسيادتكم وبيانتكم كالتالي

اسم العضو أ.د: ${request.staffName}
${request.operationType === 'create' ? 'البريد الإلكتروني الجديد:' : 'البريد الإلكتروني:'} ${request.emailAddress || request.contactEmail}
${request.generatedPassword ? `الباسورد: ${request.generatedPassword}` : 'لم يتم توليد كلمة مرور بعد'}
الرقم القومي: ${request.nationalId}

برجاء ادخال الباسورد وتغيرها عند اول دخول علي الايميل

شكرا لسيادتكم
مهندس بولس سمير
مدير وحدة تكنولوجيا المعلومات`;
            
            // Encode message for URL
            const encodedMessage = encodeURIComponent(message);
            
            // Create WhatsApp URL
            const whatsappUrl = `https://wa.me/${mobileNumber}?text=${encodedMessage}`;
            
            // Open WhatsApp in new tab
            window.open(whatsappUrl, '_blank');
            
            showNotification('تم فتح واتساب لإرسال الرسالة', 'info');
        }
        
        // Send Email Message
        function sendEmailMessage(request) {
            const emailAddress = document.getElementById('sendEmailAddress').value || request.contactEmail;
            const emailSubject = document.getElementById('emailSubject').value;
            
            if (!emailAddress || !validateEmail(emailAddress)) {
                showNotification('يرجى إدخال بريد إلكتروني صحيح', 'warning');
                return;
            }
            
            // Create email body
            const emailBody = `نفيد علم سيادتكم تم ${request.operationType === 'create' ? 'إنشاء' : 'إعادة تعيين'} الباسورد الخاصة بسيادتكم وبيانتكم كالتالي

اسم العضو أ.د: ${request.staffName}
${request.operationType === 'create' ? 'البريد الإلكتروني الجديد:' : 'البريد الإلكتروني:'} ${request.emailAddress || request.contactEmail}
${request.generatedPassword ? `الباسورد: ${request.generatedPassword}` : 'لم يتم توليد كلمة مرور بعد'}
الرقم القومي: ${request.nationalId}

برجاء ادخال الباسورد وتغيرها عند اول دخول علي الايميل

شكرا لسيادتكم
مهندس بولس سمير
مدير وحدة تكنولوجيا المعلومات
جامعة المنيا`;
            
            // Create mailto link
            const mailtoLink = `mailto:${emailAddress}?subject=${encodeURIComponent(emailSubject)}&body=${encodeURIComponent(emailBody)}`;
            
            // Open email client
            window.location.href = mailtoLink;
            
            showNotification('تم فتح بريدك الإلكتروني لإرسال الرسالة', 'info');
        }
        
        // Delete Rejected Requests
        async function deleteRejectedRequests() {
            try {
                const rejectedRequests = requests.filter(r => r.status === 'rejected');
                const deletePromises = rejectedRequests.map(request => 
                    database.ref('requests/' + request.id).remove()
                );
                
                await Promise.all(deletePromises);
                showNotification(`تم حذف ${rejectedRequests.length} طلب مرفوض`, 'success');
                loadRequests();
            } catch (error) {
                console.error('Error deleting rejected requests:', error);
                showNotification('حدث خطأ أثناء حذف الطلبات المرفوضة', 'error');
            }
        }
        
        // Delete Old Requests
        async function deleteOldRequests() {
            try {
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                
                const oldRequests = requests.filter(r => new Date(r.timestamp) < thirtyDaysAgo);
                const deletePromises = oldRequests.map(request => 
                    database.ref('requests/' + request.id).remove()
                );
                
                await Promise.all(deletePromises);
                showNotification(`تم حذف ${oldRequests.length} طلب قديم`, 'success');
                loadRequests();
            } catch (error) {
                console.error('Error deleting old requests:', error);
                showNotification('حدث خطأ أثناء حذف الطلبات القديمة', 'error');
            }
        }
        
        // Delete All Requests
        async function deleteAllRequests() {
            try {
                await database.ref('requests').remove();
                showNotification('تم حذف جميع البيانات بنجاح', 'success');
                loadRequests();
            } catch (error) {
                console.error('Error deleting all requests:', error);
                showNotification('حدث خطأ أثناء حذف جميع البيانات', 'error');
            }
        }
        
        // Download All Requests
        function downloadAllRequests() {
            if (requests.length === 0) {
                showNotification('لا توجد طلبات للتحميل', 'warning');
                return;
            }
            
            // Create CSV content
            let csvContent = "data:text/csv;charset=utf-8,\uFEFF";
            csvContent += "رقم,اسم العضو,الرقم القومي,رقم الهاتف,البريد الإلكتروني للتواصل,نوع العملية,البريد الإلكتروني,تاريخ الطلب,الحالة,كلمة المرور\n";
            
            requests.forEach((request, index) => {
                const row = [
                    index + 1,
                    `أ.د/ ${request.staffName}`,
                    request.nationalId,
                    request.mobileNumber,
                    request.contactEmail,
                    request.operationType === 'create' ? 'إنشاء' : 'إعادة تعيين',
                    request.emailAddress || 'غير محدد',
                    new Date(request.timestamp).toLocaleDateString('ar-EG'),
                    request.status === 'approved' ? 'تمت الموافقة' : request.status === 'rejected' ? 'مرفوض' : 'قيد الانتظار',
                    request.generatedPassword || ''
                ];
                csvContent += row.join(",") + "\n";
            });
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "جميع_الطلبات_" + new Date().toISOString().split('T')[0] + ".csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('تم تحميل جميع الطلبات', 'success');
        }
        
        // Export All Data
        function exportAllData() {
            downloadAllRequests(); // Same as download all requests for now
        }
        
        // Export All PDF
        function exportAllPDF() {
            if (requests.length === 0) {
                showNotification('لا توجد طلبات للتصدير', 'warning');
                return;
            }
            
            // Create PDF content (HTML for printing)
            let pdfContent = `
                <!DOCTYPE html>
                <html dir="rtl" lang="ar">
                <head>
                    <meta charset="UTF-8">
                    <title>تقرير جميع الطلبات</title>
                    <style>
                        body {
                            font-family: 'Cairo', sans-serif;
                            padding: 15px;
                        }
                        .header {
                            text-align: center;
                            border-bottom: 2px solid #0c2461;
                            padding-bottom: 15px;
                            margin-bottom: 20px;
                        }
                        .university-name {
                            color: #0c2461;
                            font-size: 22px;
                            font-weight: bold;
                        }
                        .title {
                            color: #26d0ce;
                            font-size: 18px;
                            margin-top: 8px;
                        }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-top: 15px;
                            font-size: 12px;
                        }
                        th, td {
                            border: 1px solid #ddd;
                            padding: 8px;
                            text-align: center;
                        }
                        th {
                            background-color: #0c2461;
                            color: white;
                        }
                        .footer {
                            margin-top: 30px;
                            text-align: center;
                            color: #666;
                            font-size: 12px;
                        }
                        @page {
                            size: A4 landscape;
                            margin: 15mm;
                        }
                        @media print {
                            body {
                                padding: 0;
                            }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <div class="university-name">جامعة المنيا</div>
                        <div class="title">مركز تكنولوجيا المعلومات</div>
                        <div class="title">تقرير جميع الطلبات</div>
                        <div class="title">تاريخ التقرير: ${new Date().toLocaleDateString('ar-EG')}</div>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>اسم العضو</th>
                                <th>الرقم القومي</th>
                                <th>رقم الهاتف</th>
                                <th>نوع العملية</th>
                                <th>البريد الإلكتروني</th>
                                <th>تاريخ الطلب</th>
                                <th>الحالة</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            requests.forEach((request, index) => {
                pdfContent += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>أ.د/ ${request.staffName}</td>
                        <td>${request.nationalId}</td>
                        <td>${request.mobileNumber}</td>
                        <td>${request.operationType === 'create' ? 'إنشاء' : 'إعادة تعيين'}</td>
                        <td>${request.emailAddress || request.contactEmail || 'غير محدد'}</td>
                        <td>${new Date(request.timestamp).toLocaleDateString('ar-EG')}</td>
                        <td>${request.status === 'approved' ? 'تمت الموافقة' : request.status === 'rejected' ? 'مرفوض' : 'قيد الانتظار'}</td>
                    </tr>
                `;
            });
            
            pdfContent += `
                        </tbody>
                    </table>
                    
                    <div class="footer">
                        <p>تم إنشاء هذا التقرير تلقائياً بواسطة نظام إدارة طلبات البوابة الإلكترونية</p>
                        <p>جامعة المنيا - مركز تكنولوجيا المعلومات</p>
                        <p>مهندس بولس سمير - مدير وحدة تكنولوجيا المعلومات</p>
                        <p>عدد الطلبات: ${requests.length}</p>
                    </div>
                </body>
                </html>
            `;
            
            // Open in new window for printing
            const win = window.open('', '_blank');
            win.document.write(pdfContent);
            win.document.close();
            win.focus();
            
            showNotification('تم فتح التقرير للطباعة', 'info');
        }
        
        // Load Email Settings
        function loadEmailSettings() {
            const adminEmail = localStorage.getItem('adminEmail') || '';
            const senderName = localStorage.getItem('senderName') || 'مهندس بولس سمير';
            
            document.getElementById('adminEmail').value = adminEmail;
            document.getElementById('senderName').value = senderName;
        }
        
        // Save Email Settings
        function saveEmailSettings() {
            const adminEmail = document.getElementById('adminEmail').value;
            const senderName = document.getElementById('senderName').value;
            
            if (adminEmail && !validateEmail(adminEmail)) {
                showNotification('بريد المشرف غير صحيح', 'warning');
                return;
            }
            
            localStorage.setItem('adminEmail', adminEmail);
            localStorage.setItem('senderName', senderName);
            
            showNotification('تم حفظ الإعدادات بنجاح', 'success');
        }
        
        // Update Statistics
        function updateStats() {
            const totalRequests = requests.length;
            const createRequests = requests.filter(r => r.operationType === 'create').length;
            const resetRequests = requests.filter(r => r.operationType === 'reset').length;
            const pendingRequests = requests.filter(r => r.status === 'pending').length;
            
            // Update admin page stats
            document.getElementById('totalRequestsMain').textContent = totalRequests;
            document.getElementById('createRequestsMain').textContent = createRequests;
            document.getElementById('resetRequestsMain').textContent = resetRequests;
            document.getElementById('pendingRequestsMain').textContent = pendingRequests;
        }
        
        // Show Notification
        function showNotification(message, type) {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : type === 'warning' ? 'warning' : 'info'} alert-dismissible fade show position-fixed`;
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px; max-width: 500px; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2);';
            notification.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-times-circle' : type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle'} fa-lg me-2"></i>
                    <div>${message}</div>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);
        }
        
        // Initialize
        function init() {
            // Set current year in footer
            const year = new Date().getFullYear();
            const developerInfo = document.querySelector('.developer-info');
            if (developerInfo) {
                developerInfo.innerHTML += ` &copy; ${year}`;
            }
        }
        
        // Initialize the application
        init();
    </script>
</body>

</html>

